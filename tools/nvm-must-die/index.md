---
title: "Управление версиями Node.js"
description: "Что делать если вам нужно поддерживать проекты с разными версиями Node.js?"
authors:
  - baileys-li
keywords:
  - volta
  - nvm
  - npm
  - nodejs
  - package.json
related:
  - "tools/nodejs"
  - "tools/nodejs-tooling"
  - "tools/ci-cd"
tags:
  - article
---

## Короткая версиям
Просто используйте [Volta](https://volta.sh/).

## Проблема
Почти наверняка по мере развития вашей карьеры вам придётся работать сразу над несколькими проектами в которых отличаются версии Node.js. При том отличатся будут мажорные релизы (первое число в версии), а значит между версиями нет обратной совместимости.

Какие решения этой проблемы мы можем найти?

### Вручную удалять и переустанавливать
Если нам нужно единоразово сменить версии, то боящиеся консоли новички могут выбрать этот вариант. *(бояться нормально, все через это проходили)*

Но очевидно, если нам нужно **часто** переключать версии то ручная переустановка будет той ещё мукой.

### Использовать системные пакетные менеджеры
Во многих операционных системах есть специальные консольные программы, чтобы устанавливать программы. Например:
* `dnf` в Fedora.
* `pamac` в Manjaro.
* Microsoft начиная с Windows 10 разрабатывает `winget`
* Для macOS часто устанавливают [Homebrew](https://brew.sh/).

Это выглядит неплохим решением, но нужно быть уверенным что источники этих пакетных менеджеров содержат актуальные версии Node.js, а также предыдущие, если нам потребуется откатиться. На практике, это может быть не так.

К тому же этот способ требует того, чтобы все участники команды хорошо владели своим системным инструментом. А ещё при разработке [CI/CD](https://doka.guide/tools/ci-cd/) на вышей локальной машине и рабочем сервере могут быть разные пакетные менеджеры, что тоже вносит сумятицу.

### Использовать специальные решения

Как ни странно, переключаться между разными это частая потребность. А значит не удивительно, что под неё разработали специальные решение. Например:
* [nvm](https://github.com/nvm-sh/nvm) и [версия](https://github.com/coreybutler/nvm-windows) под Windows.
* [n](https://github.com/tj/n)
* [nvs](https://github.com/jasongin/nvs)
* [nodist](https://github.com/nullivex/nodist)
* Volta

nvm (Node Version Manager) — самое популярное решение, но автор этой статьи рекомендует использовать Volta. На сегодняшний день самый универсальный и удобный способ управлять версиями Node.js.

## Работаем с Volta

### Установка
Для macOS и других Unix систем достаточно просто прогнать установочный скрипт через bash.

```bash
curl https://get.volta.sh | bash
```
Для Windows можно использовать `.msi` установщик с официального сайта или [страницы релизов](https://github.com/volta-cli/volta/releases) в GitHub репозитории. Альтернативно вы можете использовать winget:

```bash
winget install --id Volta.Volta
```

Далее проверим, что программа корректно установилась:
```bash
volta -v
```

Если программа не найдена, то просто перезагрузите компьютер.

### Как пользоваться
С помощью этой команды вы установите стандартную версию Node.js для вашего компьютера:
```bash
volta install node
```
Можно так же уточнить желаемую версию. К примеру, `node@16` установит последнюю 16 версию. Однако по умолчанию установится текущий lts релиз, что и так лучший вариант.

А вот если вы работаете над проектом, который написан для Node.js 14, то в корне папки этого пакета введите:
```bash
volta pin node@14
```

И в `package.json` появится поле:
```json
{
  "volta": {
    "node": "14.21.3"
  }
}
```
В отличии от других подобных инструментов, Volta сама будет переключать версию Node.js как только пользователь запускает Node.js в этом проекте. Но как только пользователь выйдет из проекта, то в консоли будет доступна та же версия, что была установлена через `volta install`.

Пример:
```bash
node -v
# v18.15.0

mkdir node12 # создаём проект под Node.js 12
cd node12 # заходим в папку
npm init -y # инициализируем проект
volta pin node@12 # фиксируем версию.

node -v
# 12.22.12
cd .. # выйдем из проекта

node -v
# v18.15.0
```

### Преимущества Volta в сравнении с nvm
* Автоматизирует рутину. Как показано выше, если в `package.json` есть поле `volta.node`, версия Node.js сменится сама. В nvm нужно вручную менять версии через команду `nvm use`.
* Кроссплатформенна. nvm доступен для Unix систем, и только для определенных оболочек: если вы используете Windows или fish в Linux, то придётся ставить версии под них от сторонних разработчиков. В этих версиях могут немного отличаться команды и возможности.
* Помимо Node.js можно фиксировать версии пакетных менеджеров: npm или yarn.

### Недостатки Volta
* Вместо того, чтобы использовать стандартное поле [`engines`](https://docs.npmjs.com/cli/v9/configuring-npm/package-json#engines) используется `volta`.
* Пока что не поддерживает pnpm<a href="#note-pnpm"><sup>*</sup></a>, но работа над этим [идёт](https://github.com/volta-cli/volta/pull/1273).


## `.nvmrc` файл
Поскольку nvm все ещё очень популярное решение, то при работе с проектами вы можете столкнуться `.nvmrc` файлом.

В нём просто содержится версия Node.js с которой разрабатывался проект. nvm может установить его через команду `nvm use`. Но например версия nvm под Windows с эти файлом не работает.

Чтобы не ставить nvm, вы можете зафиксировать версию Node из этого файла с помощью Volta.

## Выводы
Volta — лучший способ установки и фиксации конкретной версии Node.js. Она имеет все шансы стать стандартом, потому что намного сильнее автоматизирует рутину в сравнении с конкурентами.

Если у всех разработчиков в вашей команды установлена Volta, то версии Ноды могут сменятся без их прямого участия.

Так же это хороший инструмент, чтобы быть уверенным что на вашем CI/CD сервере та же версия Node.js, что и у вас. А популярный Гитхаб экшн setup-node уже ищет `volta.node` в [первую очередь](https://github.com/actions/setup-node/blob/main/docs/advanced-usage.md#node-version-file).


<small>

<sup id="note-pnpm">*</sup> —  лучшая альтерантива npm по версии [сообщества](https://2022.stateofjs.com/en-US/libraries/#tier_list).

</small>
